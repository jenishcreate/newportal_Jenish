@{
    ViewData["Title"] = "Distributors List";
}

<form id="csrfForm">@Html.AntiForgeryToken()</form>

<style>
    #retailerTable thead th {
        background-color: #f5f7fa;
        color: #2c3e50;
        font-weight: 600;
        border-bottom: 2px solid #616161 !important;
        color: #212121;
        font-weight: 700;
        font-size: 13px;
        text-transform: uppercase;
    }

    #retailerTable td {
        background-color: #ffffff;
        vertical-align: middle;
        font-size: 15px;
        color: #212121;
    }

        #retailerTable td:first-child {
            font-weight: 600;
            text-align: center;
        }

    div.dataTables_filter {
        margin-top: 0.75rem;
        margin-bottom: 1rem;
    }

    #retailerTable td, #retailerTable th {
        padding: 0.6rem 1rem !important;
        vertical-align: middle;
    }

    .dt-actions {
        display: flex;
        flex-wrap: nowrap;
        gap: 0.25rem;
    }
</style>

<div class="container-fluid px-3 mt-3">
    <h2 class="mb-3 text-center mt-3">Distributor List</h2>

    <div class="table-responsive">
        <table id="retailerTable" class="table table-sm table-bordered align-middle" style="width:100%">
            <thead>
                <tr>
                    <th>No</th> <!-- Updated column name -->
                    <th>User Id</th>
                    <th>Company Name</th>
                    <th>Mobile No</th>
                    <th>User Type</th>
                    <th>Email Id</th>
                    <th>Wallet Balance</th>
                    <th>Join Date</th>
                    <th>Parent Id</th>
                    <th>KYC Status</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            const token = $('input[name="__RequestVerificationToken"]').val();

            $('#retailerTable').DataTable({
                "ajax": {
                    "url": "/Admin/List/GetAllDistributor",
                    "type": "POST",
                    "datatype": "json",
                    "headers": {
                        "RequestVerificationToken": token
                    },
                    "dataSrc": function (json) {
                        return json.data;
                    },
                    "error": function (xhr) {
                        console.error("❌ AJAX error:", xhr.responseText);
                    }
                },
                "columns": [
                    {
                        "data": null,
                        "render": function (data, type, row, meta) {
                            return meta.row + 1;
                        },
                        "orderable": false
                    },
                    { "data": "userName" },
                    { "data": "companyName" },
                    { "data": "mobileNo" },
                    { "data": "userType" },
                    { "data": "emailId" },
                    { "data": "walletBalance" },
                    {
                        "data": "joinDate",
                        "render": function (data) {
                            return data ? new Date(data).toLocaleDateString() : '';
                        }
                    },
                    { "data": "parentId" },
                    { "data": "kycStatus" },
                    {
                        "data": "status",
                        "render": function (data) {
                            switch (data) {
                                case 0:
                                case "Active":
                                   return '<span class="badge bg-success">Active</span>';
                                case 1:
                                case "Inactive":
                                   return '<span class="badge bg-danger">Inactive</span>';
                                default:
                                    return '<span class="badge bg-secondary">Unknown</span>';
                            }
                        }
                    },
                    {
                        "data": "userId",
                        "render": function (data) {
                            return `
                                <div class="dt-actions">
                                    <a href="/Admin/KycManager/KycDetails?userId=${data}" class="btn btn-outline-primary btn-sm">Details</a>
                                </div>
                            `;
                        },
                        "orderable": false
                    }
                ],
                "language": {
                    "emptyTable": "No retailers available yet."
                },
                "responsive": true
            });
        });
    </script>
}
